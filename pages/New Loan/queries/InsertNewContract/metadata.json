{
  "gitSyncId": "67a2400b3e12e107acd1a186_e42224f1-f7ed-4c08-a9fc-b392d67234d9",
  "id": "New Loan_InsertNewContract",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH\ngenerated_id AS (\n  SELECT nextval('cashoperations_id_seq') AS id\n),\noperation_group AS (\n  SELECT gen_random_uuid() AS group_id\n),\nnew_loan AS (\n  INSERT INTO public.lendingevents (\n    counterparty, amountstart, amountend, contractdata,\n    startdate, enddate, currency, \"APR\", contact,\n    isfinished, \"owner\", platform, \"lendcontractID\", operation_group\n  )\n  VALUES (\n    {{counterparty.text}},\n    {{amountstart.text}}::money,\n    {{amountend.text}}::money,\n    {{contractdata.text}},\n    {{moment(startdate.selectedDate).format(\"YYYY-MM-DD\") }},\n    {{moment(enddate.selectedDate).format(\"YYYY-MM-DD\")}},\n    {{currency.selectedOptionValue}},\n    {{parseFloat(APR.text)}},\n    {{contact.text}},\n    FALSE,\n    {{owner.selectedOptionLabel}}::char(5),\n    {{plaform.selectedOptionValue}}::INTEGER,\n    {{lendcontractID.text}},\n    (SELECT group_id FROM operation_group)\n  )\n  RETURNING amountstart, currency, platform, \"owner\"\n),\ninsert_cash_out AS (\n  INSERT INTO cashoperations (\n    id, direction, owner_id, date,\n    platform_id, currency_id, amount,\n    fee, description, operation_group\n  )\n  SELECT\n    generated_id.id,\n    'out',\n    new_loan.\"owner\",\n    CURRENT_TIMESTAMP,\n    (Select \"id\" from public.platforms where name = {{Source.selectedOptionValue}}),\n\t {{currency.selectedOptionValue}},\n    (new_loan.amountstart::text)::double precision,\n    0,\n    {{currency.selectedOptionLabel}} || ' Loan issued on ' || {{plaform.selectedOptionLabel}},\n    (SELECT group_id FROM operation_group)\n  FROM new_loan, generated_id\n  RETURNING *\n)\nINSERT INTO cashoperations (\n  id, direction, owner_id, date,\n  platform_id, currency_id, amount,\n  fee, description, operation_group\n)\nSELECT\n  generated_id.id,\n  'in',\n  'EXT',\n  CURRENT_TIMESTAMP,\n  {{plaform.selectedOptionValue}}::INTEGER,\n\t {{currency.selectedOptionValue}},\n  (new_loan.amountstart::text)::double precision,\n  0,\n  'Counterparty ' || {{counterparty.text}} || ' receives loan',\n  (SELECT group_id FROM operation_group)\nFROM new_loan, generated_id;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "WieczorekAssets",
      "isAutoGenerated": false,
      "name": "WieczorekAssets",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "executeOnLoad": false,
    "name": "InsertNewContract",
    "pageId": "New Loan",
    "userSetOnLoad": false
  }
}