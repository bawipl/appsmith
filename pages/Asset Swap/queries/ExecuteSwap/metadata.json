{
  "gitSyncId": "67a2400b3e12e107acd1a186_asset-swap-execute",
  "id": "Asset Swap_ExecuteSwap",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "-- Asset Swap Transaction\n-- Creates 4 cash operations: 2 for each leg of the swap\n-- Leg 1: Owner1 sends Asset1 to Owner2\n-- Leg 2: Owner2 sends Asset2 to Owner1\n\nWITH\nswap_group AS (\n  SELECT gen_random_uuid() AS group_id\n),\nleg1_out AS (\n  -- Owner1 sends out Asset1\n  INSERT INTO cashoperations (\n    id, direction, owner_id, date,\n    platform_id, currency_id, amount,\n    fee, description, operation_group\n  )\n  SELECT\n    nextval('cashoperations_id_seq'),\n    'out',\n    {{Owner1Select.selectedOptionValue}}::char(5),\n    CURRENT_TIMESTAMP,\n    {{Platform1Select.selectedOptionValue}}::INTEGER,\n    {{Currency1Select.selectedOptionValue}}::INTEGER,\n    {{Amount1Input.text}}::DOUBLE PRECISION,\n    0,\n    'Swap OUT: ' || {{Amount1Input.text}} || ' ' || {{Currency1Select.selectedOptionLabel}} || ' to ' || {{Owner2Select.selectedOptionLabel}} || ' (swap with ' || {{Amount2Input.text}} || ' ' || {{Currency2Select.selectedOptionLabel}} || ')',\n    (SELECT group_id FROM swap_group)\n  RETURNING id\n),\nleg1_in AS (\n  -- Owner2 receives Asset1\n  INSERT INTO cashoperations (\n    id, direction, owner_id, date,\n    platform_id, currency_id, amount,\n    fee, description, operation_group\n  )\n  SELECT\n    nextval('cashoperations_id_seq'),\n    'in',\n    {{Owner2Select.selectedOptionValue}}::char(5),\n    CURRENT_TIMESTAMP,\n    {{Platform1Select.selectedOptionValue}}::INTEGER,\n    {{Currency1Select.selectedOptionValue}}::INTEGER,\n    {{Amount1Input.text}}::DOUBLE PRECISION,\n    0,\n    'Swap IN: ' || {{Amount1Input.text}} || ' ' || {{Currency1Select.selectedOptionLabel}} || ' from ' || {{Owner1Select.selectedOptionLabel}} || ' (swap for ' || {{Amount2Input.text}} || ' ' || {{Currency2Select.selectedOptionLabel}} || ')',\n    (SELECT group_id FROM swap_group)\n  RETURNING id\n),\nleg2_out AS (\n  -- Owner2 sends out Asset2\n  INSERT INTO cashoperations (\n    id, direction, owner_id, date,\n    platform_id, currency_id, amount,\n    fee, description, operation_group\n  )\n  SELECT\n    nextval('cashoperations_id_seq'),\n    'out',\n    {{Owner2Select.selectedOptionValue}}::char(5),\n    CURRENT_TIMESTAMP,\n    {{Platform2Select.selectedOptionValue}}::INTEGER,\n    {{Currency2Select.selectedOptionValue}}::INTEGER,\n    {{Amount2Input.text}}::DOUBLE PRECISION,\n    0,\n    'Swap OUT: ' || {{Amount2Input.text}} || ' ' || {{Currency2Select.selectedOptionLabel}} || ' to ' || {{Owner1Select.selectedOptionLabel}} || ' (swap with ' || {{Amount1Input.text}} || ' ' || {{Currency1Select.selectedOptionLabel}} || ')',\n    (SELECT group_id FROM swap_group)\n  RETURNING id\n),\nleg2_in AS (\n  -- Owner1 receives Asset2\n  INSERT INTO cashoperations (\n    id, direction, owner_id, date,\n    platform_id, currency_id, amount,\n    fee, description, operation_group\n  )\n  SELECT\n    nextval('cashoperations_id_seq'),\n    'in',\n    {{Owner1Select.selectedOptionValue}}::char(5),\n    CURRENT_TIMESTAMP,\n    {{Platform2Select.selectedOptionValue}}::INTEGER,\n    {{Currency2Select.selectedOptionValue}}::INTEGER,\n    {{Amount2Input.text}}::DOUBLE PRECISION,\n    0,\n    'Swap IN: ' || {{Amount2Input.text}} || ' ' || {{Currency2Select.selectedOptionLabel}} || ' from ' || {{Owner2Select.selectedOptionLabel}} || ' (swap for ' || {{Amount1Input.text}} || ' ' || {{Currency1Select.selectedOptionLabel}} || ')',\n    (SELECT group_id FROM swap_group)\n  RETURNING id\n)\nSELECT \n  (SELECT group_id FROM swap_group) AS swap_id,\n  (SELECT id FROM leg1_out) AS leg1_out_id,\n  (SELECT id FROM leg1_in) AS leg1_in_id,\n  (SELECT id FROM leg2_out) AS leg2_out_id,\n  (SELECT id FROM leg2_in) AS leg2_in_id;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": true,
    "datasource": {
      "id": "WieczorekAssets",
      "isAutoGenerated": false,
      "name": "WieczorekAssets",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "executeOnLoad": false,
    "name": "ExecuteSwap",
    "pageId": "Asset Swap",
    "userSetOnLoad": false
  }
}